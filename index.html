<script type="text/javascript"> 
function initGovMap() { 
    govmap.createMap('map', { 
        token: 'ede9a5fd-7c23-432f-8ffb-d85feffa3f3c', 
        layers: ["GASSTATIONS","PARCEL_HOKS", "KSHTANN_ASSETS", "bus_stops", "PARCEL_ALL","219111","219113","219114"], 
        showXY: true, 
        identifyOnClick: true, 
        isEmbeddedToggle: false, 
        background: 2, 
        layersMode: 1, 
        zoomButtons: false, 
        level: 9, 
        extent: {xmin: 193700, ymin: 664900, xmax: 195000, ymax: 666100}, 
    }); 
} 

//----------------------------------------
// toggle drawing mode
//----------------------------------------
function toggleButton() {
    const btn = document.getElementById('showButton');
    const resultsDiv = document.getElementById('results');

    // אם הכפתור הופך לאדום – מתחילים ציור
    if (!btn.classList.contains('redButton')) {
        btn.classList.add('redButton');

        var params = { 
            continous: false, 
            drawType: govmap.drawType.Rectangle, 
            filterLayer: false, 
            isZoomToExtent: true, 
            layers: [ 'PARCEL_ALL',"219111","219113","219114"], 
            returnFields: { 
                'PARCEL_ALL': [], 
                "219111":['value0', 'value1', 'value2','value3','value4'],
                "219113":['value0', 'value1', 'value2','value3','value4'],
                "219114":['value0', 'value1', 'value2','value3','value4']
            } 
        };

        govmap.selectFeaturesOnMap(params).then(function(response1) {
            // אחרי בחירה – להחזיר הכפתור לירוק
            btn.classList.remove('redButton');
            console.log('selectFeaturesOnMap response:', response1); 
            
            if (response1 && response1.length > 0) { 
                var html = '<h3>תוצאות מ-selectFeaturesOnMap:</h3>'; 
                html += '<p>נמצאו ' + response1.length + ' שכבות עם תוצאות</p>'; 
                html += '<pre>' + JSON.stringify(response1, null, 2) + '</pre>'; 
                resultsDiv.innerHTML = html; 
                
                govmap.getLayerEntities(response1).then(function(response2) { 
                    console.log('getLayerEntities response:', response2); 
                    
                    html += '<hr><h3>תוצאות מ-getLayerEntities:</h3>'; 
                    html += '<pre>' + JSON.stringify(response2, null, 2) + '</pre>'; 
                    resultsDiv.innerHTML = html; 
                    
                }).catch(function(error) { 
                    console.error('Error in getLayerEntities:', error); 
                    html += '<hr><p style="color: red;">שגיאה ב-getLayerEntities: ' + error.message + '</p>'; 
                    resultsDiv.innerHTML = html; 
                }); 
                
            } else { 
                resultsDiv.innerHTML = '<p>לא נמצאו תוצאות באזור שנבחר</p>'; 
            } 
            
        }).catch(function(error) { 
            console.error('Error in selectFeaturesOnMap:', error); 
            btn.classList.remove('redButton');
            resultsDiv.innerHTML = '<p style="color: red;">שגיאה: ' + error.message + '</p>'; 
        }); 

    // אם הכפתור היה אדום ולחצת שוב – מחזירים לירוק בלי לצייר
    } else {
        btn.classList.remove('redButton');
        // כאן אם אתה רוצה – אפשר להוסיף govmap.cancelDrawing();
    }
}
</script>
