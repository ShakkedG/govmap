<script type="text/javascript"> 
function initGovMap() { 
    govmap.createMap('map', { 
        token: 'ede9a5fd-7c23-432f-8ffb-d85feffa3f3c',
        layers: ["GASSTATIONS","PARCEL_HOKS","KSHTANN_ASSETS","bus_stops","PARCEL_ALL","219111","219113","219114"],
        showXY: true,
        identifyOnClick: true,
        isEmbeddedToggle: false,
        background: 2,
        layersMode: 1,
        zoomButtons: false,
        level: 9,
        extent: {xmin:193700, ymin:664900, xmax:195000, ymax:666100}
    });
}

//----------------------------------------
// BUTTON LOGIC
//----------------------------------------
function toggleButton() {
    const btn = document.getElementById('showButton');

    // Enter drawing mode
    if (!btn.classList.contains('redButton')) {
        btn.classList.add('redButton');
        showExample();
    } 
    // Exit drawing mode
    else {
        btn.classList.remove('redButton');
        govmap.cancelDrawing();
    }
}

//----------------------------------------
function showExample(){ 
    var params = { 
        continous: false,
        drawType: govmap.drawType.Rectangle,
        filterLayer: false,
        isZoomToExtent: true,
        layers: ['GASSTATIONS','PARCEL_HOKS','KSHTANN_ASSETS','bus_stops','PARCEL_ALL','219111','219113','219114'],
        returnFields: {
            'GASSTATIONS': ['objectid','company'],
            '219111': ['objectid'],
            '219113': ['objectid'],
            '219114': ['objectid']
        }
    }; 
    
    var resultsDiv = document.getElementById('results'); 
    
    // When region is selected → Promise resolves
    govmap.selectFeaturesOnMap(params).then(function(response1) { 
        
        // <<< NEW: automatically reset button color
        document.getElementById("showButton").classList.remove("redButton");

        console.log('selectFeaturesOnMap response:', response1);

        if (response1 && response1.length > 0) {
            var html = '<h3>תוצאות מ-selectFeaturesOnMap:</h3>';
            html += '<p>נמצאו ' + response1.length + ' שכבות עם תוצאות</p>';
            html += '<pre>' + JSON.stringify(response1, null, 2) + '</pre>';
            resultsDiv.innerHTML = html;

            govmap.getLayerEntities(response1).then(function(response2) {
                html += '<hr><h3>תוצאות מ-getLayerEntities:</h3>';
                html += '<pre>' + JSON.stringify(response2, null, 2) + '</pre>';
                resultsDiv.innerHTML = html;
            });
        } else {
            resultsDiv.innerHTML = '<p>לא נמצאו תוצאות באזור שנבחר</p>';
        }

    }).catch(function(error) {
        resultsDiv.innerHTML = '<p style="color:red;">שגיאה: ' + error.message + '</p>';
        
        // Also restore button on error
        document.getElementById("showButton").classList.remove("redButton");
    });
}
</script>

<style>
.redButton {
    background-color: red !important;
}
</style>
