<html xmlns="http://www.w3.org/1999/xhtml"> 
<head> 
    <script src="https://www.govmap.gov.il/govmap/api/govmap.api.js" defer onload="initGovMap()"></script> 

    <script type="text/javascript"> 
    function initGovMap() { 
        govmap.createMap('map', { 
            token: 'ede9a5fd-7c23-432f-8ffb-d85feffa3f3c', 
            layers: ["GASSTATIONS","PARCEL_HOKS", "KSHTANN_ASSETS", "bus_stops", "PARCEL_ALL","219111","219113","219114"], 
            showXY: true, 
            identifyOnClick: true, 
            isEmbeddedToggle: false, 
            background: 2, 
            layersMode: 1, 
            zoomButtons: false, 
            level: 9, 
            //extent: {xmin: 193700, ymin: 664900, xmax: 195000, ymax: 666100}, 
        }); 
    } 

    // פונקציה שרצה בלחיצה על הכפתור
    function toggleButton() {
        const btn = document.getElementById('showButton');
        const resultsDiv = document.getElementById('results');

        // הכפתור אינו אדום → נכנסים למצב ציור
        if (!btn.classList.contains('redButton')) {
            btn.classList.add('redButton');

          var params = { 
    continous: false,
    drawType: govmap.drawType.Rectangle,
    filterLayer: false,
    isZoomToExtent: true,
    layers: ["GASSTATIONS"],   // שכבה בסיסית שעבדה לך קודם
    returnFields: {
        "GASSTATIONS": ["objectid", "company"]
    }
};


            govmap.selectFeaturesOnMap(params).then(function(response1) { 
                // אחרי שהמשתמש סיים לצייר מלבן
                btn.classList.remove('redButton');
                resultsDiv.style.display = 'block';

                console.log('selectFeaturesOnMap response:', response1); 
                
                if (response1 && response1.length > 0) { 
                    var html = '<h3>תוצאות מ-selectFeaturesOnMap:</h3>'; 
                    html += '<p>נמצאו ' + response1.length + ' שכבות עם תוצאות</p>'; 
                    html += '<pre>' + JSON.stringify(response1, null, 2) + '</pre>'; 
                    resultsDiv.innerHTML = html; 
                    
                    govmap.getLayerEntities(response1).then(function(response2) { 
                        console.log('getLayerEntities response:', response2); 
                        
                        html += '<hr><h3>תוצאות מ-getLayerEntities:</h3>'; 
                        html += '<pre>' + JSON.stringify(response2, null, 2) + '</pre>'; 
                        resultsDiv.innerHTML = html; 
                        
                    }).catch(function(error) { 
                        console.error('Error in getLayerEntities:', error); 
                        html += '<hr><p style="color: red;">שגיאה ב-getLayerEntities: ' + error.message + '</p>'; 
                        resultsDiv.innerHTML = html; 
                    }); 
                    
                } else { 
                    resultsDiv.innerHTML = '<p>לא נמצאו תוצאות באזור שנבחר</p>'; 
                } 
                
            }).catch(function(error) { 
                console.error('Error in selectFeaturesOnMap:', error); 
                btn.classList.remove('redButton');
                resultsDiv.style.display = 'block';
                resultsDiv.innerHTML = '<p style="color: red;">שגיאה: ' + error.message + '</p>'; 
            }); 

        // הכפתור כבר אדום → מחזירים אותו לירוק, בלי להתחיל ציור חדש
        } else {
            btn.classList.remove('redButton');
        }
    }
    </script> 

    <style> 
    body { 
        margin: 0; 
        padding: 0; 
        font-family: Arial, sans-serif; 
    } 

    #header { 
        position: absolute; 
        top: 0; 
        left: 0; 
        right: 0; 
        height: 80px; 
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
        color: white; 
        display: flex; 
        align-items: center; 
        justify-content: space-between; 
        padding: 0 30px; 
        box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
        z-index: 1001; 
    } 

    #header h1 { 
        margin: 0; 
        font-size: 32px; 
        font-weight: bold; 
    } 

    #map-container { 
        position: relative; 
        width: 100vw; 
        height: 100vh; 
        padding-top: 80px; 
        box-sizing: border-box; 
    } 

    #map { 
        width: 100%; 
        height: 100%; 
    } 

    #button-container { 
        position: absolute; 
        top: 100px; 
        left: 20px; 
        z-index: 1000; 
    } 

    #showButton { 
        padding: 15px 30px; 
        font-size: 18px; 
        background-color: #4CAF50; 
        color: white; 
        border: none; 
        border-radius: 5px; 
        cursor: pointer; 
        box-shadow: 0 4px 6px rgba(0,0,0,0.3); 
    } 

    #showButton:hover { 
        background-color: #45a049; 
    } 

    .redButton {
        background-color: red !important;
    }

    #results { 
        position: absolute; 
        bottom: 20px; 
        left: 20px; 
        right: 20px; 
        max-height: 400px; 
        overflow: auto; 
        background: white; 
        padding: 15px; 
        border-radius: 5px; 
        box-shadow: 0 4px 6px rgba(0,0,0,0.3); 
        z-index: 1000; 
        display: none; 
    } 

    #results pre { 
        background: #f5f5f5; 
        padding: 10px; 
        border-radius: 3px; 
        overflow-x: auto; 
    } 

    #results hr { 
        margin: 15px 0; 
        border: none; 
        border-top: 2px solid #ddd; 
    } 
    </style> 
</head> 

<body> 
    <div id="header"> 
        <h1>מערכת מיפוי GovMap</h1> 
        <div style="font-size: 18px;">ניתוח שכבות מפה</div> 
    </div> 

    <div id="map-container"> 
        <div id="button-container"> 
            <button id="showButton" onClick="toggleButton()">בחר אזור במפה</button> 
        </div> 
        
        <div id="map"></div> 
        <div id="results"></div> 
    </div> 
</body> 
</html>


