<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <script src="https://www.govmap.gov.il/govmap/api/govmap.api.js" defer onload="initGovMap()"></script>
    <script type="text/javascript">
        function initGovMap() {
            govmap.createMap('map', {
                token: 'ede9a5fd-7c23-432f-8ffb-d85feffa3f3c',
                layers: ["GASSTATIONS","PARCEL_HOKS", "KSHTANN_ASSETS", "bus_stops", "PARCEL_ALL","219111","219113","219114"],
                showXY: true,
                identifyOnClick: true,
                isEmbeddedToggle: true,
                background: "2",
                layersMode: 1,
                zoomButtons: false,
                center: { x: 194366, y: 665500 }
            });
        }
        
        function showExample(){
            document.getElementById('results').innerHTML = '<p style="color:blue;">מתחיל... צייר מלבן על המפה</p>';
            
            var params = {
                continous: false,
                drawType: govmap.drawType.Rectangle,
                layers: ['GASSTATIONS', 'PARCEL_HOKS', 'KSHTANN_ASSETS', 'bus_stops', 'PARCEL_ALL', '219111', '219113', '219114'],
                selectOnMap: false,
                isZoomToExtent: false,
                filterLayer: false
            }
            
            govmap.selectFeaturesOnMap(params)
                .then(function(response) {
                    console.log('Response received:', response);
                    
                    if (!response) {
                        document.getElementById('results').innerHTML = '<p style="color:red;">לא התקבלה תגובה מהשרת</p>';
                        return;
                    }
                    
                    var html = '<h3>תוצאות:</h3>';
                    var foundAny = false;
                    
                    // Go through each layer in the response
                    for (var layerName in response) {
                        if (response.hasOwnProperty(layerName)) {
                            var features = response[layerName];
                            if (features && features.length > 0) {
                                foundAny = true;
                                html += '<h4>' + layerName + ' (' + features.length + ' תוצאות)</h4>';
                                html += '<pre style="max-height: 200px; overflow: auto; background: #f0f0f0; padding: 10px;">';
                                html += JSON.stringify(features, null, 2);
                                html += '</pre>';
                            }
                        }
                    }
                    
                    if (!foundAny) {
                        html += '<p>לא נמצאו תוצאות באזור שנבחר. נסה לצייר מלבן גדול יותר או באזור אחר.</p>';
                    }
                    
                    document.getElementById('results').innerHTML = html;
                })
                .catch(function(error) {
                    console.error('Error:', error);
                    document.getElementById('results').innerHTML = 
                        '<p style="color:red;">שגיאה: ' + (error.message || error) + '</p>';
                });
        }
    </script>
</head>
<body>
    <div id="map" style="width:900px;height:600px;"></div>
    <button onClick="showExample()" style="padding: 10px 20px; font-size: 16px; margin-top: 10px;">Show Example</button>
    <div id="results" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc; background: #f9f9f9;">
        לחץ על הכפתור ואז צייר מלבן על המפה
    </div>
</body>
</html>
